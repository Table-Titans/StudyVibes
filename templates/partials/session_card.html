{% set course = courses|selectattr("id", "equalto", session.course_id)|first if session.course_id else None %}
{% set location = locations|selectattr("id", "equalto", session.location_id)|first if session.location_id else None %}
{% set tag_ids = session.tag_ids if session.tag_ids is defined and session.tag_ids is not none else [] %}
{% set tag_ns = namespace(items=[]) %}
{% if tags is defined and tag_ids %}
    {% for tag in tags %}
        {% if tag.id in tag_ids %}
            {% set tag_ns.items = tag_ns.items + [tag.tag_name] %}
        {% endif %}
    {% endfor %}
{% endif %}
{% set chill_map = {1: "ðŸ˜Ž", 2: "ðŸ¤“", 3: "ðŸ˜¤", "1": "ðŸ˜Ž", "2": "ðŸ¤“", "3": "ðŸ˜¤"} %}
{% set chill_display = chill_map.get(session.chill_level, session.chill_level) %}
<div class="session_card {{ 'chill' if session.chill_level == 1 else 'moderate' if session.chill_level == 2 else 'intense' if session.chill_level == 3 else '' }}" 
     data-session-id="{{ session.id }}"
     data-course-id="{{ session.course_id if session.course_id else '' }}"
     data-location-id="{{ session.location_id if session.location_id else '' }}"
     data-course-name="{{ course.title if course else '' }}"
     data-location-address="{{ location.address if location else '' }}"
     data-course-year="{{ course.year if course else '' }}"
     data-course-term="{{ course.term if course else '' }}"
     data-professor-name="{{ course.professor_name if course else '' }}"
     data-tags="{{ tag_ns.items|join(',') }}">
    <a class="session-card-link" href="{{ url_for('view_session', session_id=session.id) }}">
        <div class="session_info">
            {% if chill_display %}
                <div class="session-chill-emoji" aria-label="Chill level">
                    {{ chill_display }}
                </div>
            {% endif %}
            <div class="session-text">
                <h1>{{ session.title }}</h1>
                <p class="session-meta-line location">Location: <span>{{ session.location }}</span></p>
                <p class="session-meta-line time">Time: <span>{{ session.time }}</span></p>
                <p class="session-meta-line attendees">Attendees: <span>{{ session.attendees }}</span></p>
                {% if tag_ns.items %}
                    <div class="session-tags">
                        {% for tag_name in tag_ns.items %}
                            <span class="tag-pill">{{ tag_name|title }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </a>
    <div class="session-card-actions">
        {% if section == 'my_sessions' %}
            {% if session.is_organizer %}
                <a href="{{ url_for('edit_session', session_id=session.id) }}" class="action edit-session">Edit Session</a>
                <button class="action delete-session" data-session-id="{{ session.id }}">Delete Session</button>
            {% else %}
                <button class="action leave-session" data-session-id="{{ session.id }}">Leave Session</button>
            {% endif %}
        {% else %}
            <button class="action join-session" data-session-id="{{ session.id }}">Join Session</button>
        {% endif %}
    </div>
</div>
